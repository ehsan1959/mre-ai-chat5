<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>MRE AI</title>    <script src="https://accounts.google.com/gsi/client" async defer></script>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }        :root {            --sidebar-width: 260px;            --primary: #ff69b4;            --primary-hover: #ff1493;            --bg-main: #fff5f7;            --bg-user: #ffe4e9;            --bg-ai: #ffffff;            --text: #2d1b2e;            --text-light: #6b4c6f;            --border: #ffc0cb;            --shadow: rgba(255, 105, 180, 0.15);        }        body {            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e9 50%, #ffd1dc 100%);            color: var(--text);            min-height: 100vh;            overflow-x: hidden;        }        /* Loading Screen */        #loadingScreen {            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e9 50%, #ffd1dc 100%);            display: flex;            flex-direction: column;            justify-content: center;            align-items: center;            z-index: 9999;            opacity: 0;            visibility: visible;            animation: screenFadeIn 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;        }        @keyframes screenFadeIn {            0% {                opacity: 0;            }            100% {                opacity: 1;            }        }        @keyframes screenFadeOut {            0% {                opacity: 1;            }            100% {                opacity: 0;            }        }        #loadingScreen.hide {            animation: screenFadeOut 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;        }        .loading-logo {            width: 150px;            height: 150px;            border-radius: 50%;            display: flex;            align-items: center;            justify-content: center;            box-shadow: 0 10px 50px rgba(255, 105, 180, 0.4);            overflow: hidden;            background: white;            opacity: 0;            animation: logoFadeIn 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.3s forwards,                       pulse 2s ease-in-out 2s infinite;        }        @keyframes logoFadeIn {            0% {                opacity: 0;                transform: scale(0.9);            }            100% {                opacity: 1;                transform: scale(1);            }        }        @keyframes logoFadeOut {            0% {                opacity: 1;                transform: scale(1);            }            100% {                opacity: 0;                transform: scale(0.9);            }        }        #loadingScreen.hide .loading-logo {            animation: logoFadeOut 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;        }        .loading-logo img {            width: 100%;            height: 100%;            object-fit: cover;        }        .loading-text {            margin-top: 24px;            font-size: 1.3rem;            font-weight: 600;            color: var(--primary);            opacity: 0;            animation: textFadeIn 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.6s forwards,                       fadeInOut 2s ease-in-out 2s infinite;        }        @keyframes textFadeIn {            0% {                opacity: 0;            }            100% {                opacity: 1;            }        }        @keyframes textFadeOut {            0% {                opacity: 1;            }            100% {                opacity: 0;            }        }        #loadingScreen.hide .loading-text {            animation: textFadeOut 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;        }        @keyframes pulse {            0%, 100% { transform: scale(1); }            50% { transform: scale(1.05); }        }        @keyframes fadeInOut {            0%, 100% { opacity: 0.7; }            50% { opacity: 1; }        }        /* Auth Container */        .auth-wrapper {            min-height: 100vh;            display: none;            align-items: center;            justify-content: center;            padding: 20px;        }        .auth-wrapper.show {            display: flex;        }        .auth-container {            background: rgba(255, 255, 255, 0.95);            backdrop-filter: blur(10px);            padding: 40px;            border-radius: 20px;            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);            width: 100%;            max-width: 420px;            border: 1px solid var(--border);        }        .auth-header {            text-align: center;            margin-bottom: 30px;        }        .auth-header h1 {            font-size: 32px;            color: var(--primary);            margin-bottom: 10px;        }        .auth-header p {            color: #6b4c6f;            font-size: 14px;        }        .form-group {            margin-bottom: 20px;        }        .form-group label {            display: block;            margin-bottom: 8px;            font-weight: 500;            color: var(--text);            font-size: 14px;        }        .form-group input {            width: 100%;            padding: 12px 16px;            border: 2px solid var(--border);            border-radius: 10px;            font-size: 15px;            transition: all 0.3s;            background: white;        }        .form-group input:focus {            outline: none;            border-color: var(--primary);            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.1);        }        .remember-me {            display: flex;            align-items: center;            gap: 8px;            margin-bottom: 20px;        }        .remember-me input[type="checkbox"] {            width: 18px;            height: 18px;            cursor: pointer;            accent-color: var(--primary);        }        .remember-me label {            font-size: 14px;            color: var(--text);            cursor: pointer;            user-select: none;        }        .btn {            width: 100%;            padding: 14px;            background: linear-gradient(135deg, var(--primary), #ff91af);            border: none;            border-radius: 10px;            color: white;            font-size: 16px;            font-weight: 600;            cursor: pointer;            transition: all 0.3s;            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);        }        .btn:hover {            transform: translateY(-2px);            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);        }        .btn:active {            transform: translateY(0);        }        .divider {            display: flex;            align-items: center;            text-align: center;            margin: 24px 0;            color: var(--text-light);            font-size: 14px;        }        .divider::before,        .divider::after {            content: '';            flex: 1;            border-bottom: 1px solid var(--border);        }        .divider::before {            margin-right: 12px;        }        .divider::after {            margin-left: 12px;        }        .google-btn {            width: 100%;            padding: 14px;            background: white;            border: 2px solid var(--border);            border-radius: 10px;            color: var(--text);            font-size: 16px;            font-weight: 600;            cursor: pointer;            transition: all 0.3s;            display: flex;            align-items: center;            justify-content: center;            gap: 10px;            margin-bottom: 20px;        }        .google-btn:hover {            background: #f8f9fa;            border-color: var(--primary);            transform: translateY(-2px);            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.2);        }        .google-btn img {            width: 20px;            height: 20px;        }        .auth-links {            text-align: center;            margin-top: 20px;        }        .auth-links a {            color: var(--primary);            text-decoration: none;            font-size: 14px;            cursor: pointer;            font-weight: 500;        }        .auth-links a:hover {            text-decoration: underline;        }        .divider {            text-align: center;            margin: 20px 0;            color: #6b4c6f;            font-size: 14px;        }        .error-message, .success-message {            padding: 12px 16px;            border-radius: 8px;            margin-bottom: 20px;            font-size: 14px;            display: none;            animation: slideIn 0.3s ease-out;        }        @keyframes slideIn {            from {                opacity: 0;                transform: translateY(-10px);            }            to {                opacity: 1;                transform: translateY(0);            }        }        .error-message {            background: #ffe4e9;            color: #d63384;            border: 1px solid #ffc0cb;        }        .success-message {            background: #d4edda;            color: #155724;            border: 1px solid #c3e6cb;        }        .hide {            display: none !important;        }        /* Chat App Styles */        #chatApp {            display: none;            width: 100vw;            height: 100vh;            position: fixed;            top: 0;            left: 0;        }        #chatApp.show {            display: block;        }        .sidebar {            position: fixed;            left: 0;            top: 0;            width: var(--sidebar-width);            height: 100vh;            background: rgba(255, 255, 255, 0.95);            backdrop-filter: blur(10px);            padding: 12px;            display: flex;            flex-direction: column;            box-shadow: 2px 0 20px rgba(255, 105, 180, 0.1);            border-right: 1px solid var(--border);            transition: transform 0.3s ease;            z-index: 100;        }        .sidebar-overlay {            display: none;            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            background: rgba(0, 0, 0, 0.5);            z-index: 99;            opacity: 0;            transition: opacity 0.3s ease;        }        .sidebar-overlay.show {            display: block;            opacity: 1;        }        @media (max-width: 768px) {            .sidebar {                transform: translateX(-100%);            }            .sidebar.open {                transform: translateX(0);            }        }        .new-chat-btn {            padding: 12px 16px;            background: linear-gradient(135deg, var(--primary), #ff91af);            border: none;            border-radius: 12px;            color: white;            cursor: pointer;            display: flex;            align-items: center;            gap: 10px;            font-size: 14px;            font-weight: 600;            transition: all 0.3s;            margin-bottom: 12px;            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);        }        .new-chat-btn:hover {            transform: translateY(-2px);            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);        }        .new-chat-btn svg {            width: 18px;            height: 18px;        }        .chat-history-section {            flex: 1;            overflow-y: auto;            margin-bottom: 12px;        }        .chat-history-section::-webkit-scrollbar {            width: 4px;        }        .chat-history-section::-webkit-scrollbar-thumb {            background: var(--border);            border-radius: 2px;        }        .chat-history-section h3 {            font-size: 12px;            color: var(--text-light);            margin-bottom: 8px;            padding: 0 8px;            text-transform: uppercase;            letter-spacing: 0.5px;            font-weight: 600;        }        .chat-history-item {            padding: 10px 12px;            margin-bottom: 4px;            border-radius: 8px;            cursor: pointer;            font-size: 13px;            color: var(--text);            transition: all 0.2s;            white-space: nowrap;            overflow: hidden;            text-overflow: ellipsis;            display: flex;            align-items: center;            justify-content: space-between;            gap: 8px;            position: relative;        }        .chat-history-item:hover {            background: var(--bg-user);            padding-right: 40px;        }        .chat-history-item.active {            background: var(--bg-user);            font-weight: 500;        }        .chat-title {            flex: 1;            overflow: hidden;            text-overflow: ellipsis;        }        .delete-chat-btn {            position: absolute;            right: 8px;            width: 24px;            height: 24px;            background: white;            border: none;            border-radius: 50%;            cursor: pointer;            display: none;            align-items: center;            justify-content: center;            color: #d63384;            transition: all 0.2s;            box-shadow: 0 2px 8px rgba(0,0,0,0.1);        }        .delete-chat-btn:hover {            background: #d63384;            color: white;            transform: scale(1.1);        }        .chat-history-item:hover .delete-chat-btn {            display: flex;        }        .delete-chat-btn svg {            width: 14px;            height: 14px;        }        .clear-history-btn {            padding: 8px 12px;            background: transparent;            border: 1px solid var(--border);            border-radius: 8px;            color: var(--text);            cursor: pointer;            font-size: 12px;            width: 100%;            transition: all 0.2s;            margin-top: 8px;            display: flex;            align-items: center;            justify-content: center;            gap: 6px;        }        .clear-history-btn:hover {            background: #ffe4e9;            border-color: #d63384;            color: #d63384;        }        .clear-history-btn svg {            width: 14px;            height: 14px;        }        .sidebar-footer {            border-top: 1px solid var(--border);            padding-top: 12px;            margin-top: auto;        }        .user-info {            padding: 12px;            background: #ffe4e9;            border-radius: 10px;            display: flex;            align-items: center;            gap: 10px;            margin-bottom: 10px;        }        .user-avatar {            width: 40px;            height: 40px;            background: var(--primary);            border-radius: 50%;            display: flex;            align-items: center;            justify-content: center;            color: white;            font-weight: bold;            font-size: 16px;            flex-shrink: 0;            overflow: hidden;        }        .user-avatar img {            width: 100%;            height: 100%;            object-fit: cover;        }        .user-details {            flex: 1;            min-width: 0;        }        .user-name {            font-weight: 600;            font-size: 14px;            color: var(--text);            white-space: nowrap;            overflow: hidden;            text-overflow: ellipsis;        }        .user-email {            font-size: 12px;            color: #6b4c6f;            white-space: nowrap;            overflow: hidden;            text-overflow: ellipsis;        }        .logout-btn {            padding: 10px 12px;            background: transparent;            border: 1px solid var(--border);            border-radius: 10px;            color: var(--text);            cursor: pointer;            font-size: 14px;            width: 100%;            transition: all 0.2s;        }        .logout-btn:hover {            background: #ffe4e9;        }        .main-content {            margin-left: var(--sidebar-width);            height: 100vh;            display: flex;            flex-direction: column;        }        .header {            height: 60px;            display: flex;            align-items: center;            justify-content: space-between;            padding: 0 20px;            background: rgba(255, 255, 255, 0.9);            backdrop-filter: blur(10px);            border-bottom: 1px solid var(--border);            box-shadow: 0 2px 10px rgba(255, 105, 180, 0.05);        }        .header-left {            display: flex;            align-items: center;            gap: 12px;        }        .menu-toggle {            width: 40px;            height: 40px;            background: transparent;            border: none;            border-radius: 10px;            cursor: pointer;            display: none;            align-items: center;            justify-content: center;            color: var(--text);            transition: all 0.2s;        }        .menu-toggle:hover {            background: var(--bg-user);        }        .menu-toggle svg {            width: 24px;            height: 24px;        }        @media (max-width: 768px) {            .menu-toggle {                display: flex;            }        }        .header h1 {            font-size: 20px;            color: var(--primary);        }        .settings-btn {            width: 40px;            height: 40px;            background: transparent;            border: none;            border-radius: 10px;            cursor: pointer;            display: flex;            align-items: center;            justify-content: center;            color: var(--text);            transition: all 0.2s;        }        .settings-btn:hover {            background: var(--bg-user);        }        .settings-btn svg {            width: 24px;            height: 24px;        }        /* Settings Panel */        .settings-panel {            position: fixed;            right: -400px;            top: 0;            width: 400px;            height: 100vh;            background: rgba(255, 255, 255, 0.98);            backdrop-filter: blur(10px);            box-shadow: -2px 0 20px rgba(255, 105, 180, 0.2);            transition: right 0.3s ease;            z-index: 200;            padding: 20px;            overflow-y: auto;        }        .settings-panel.open {            right: 0;        }        .settings-header {            display: flex;            justify-content: space-between;            align-items: center;            margin-bottom: 30px;            padding-bottom: 15px;            border-bottom: 2px solid var(--border);        }        .settings-header h2 {            font-size: 24px;            color: var(--primary);        }        .close-settings {            width: 36px;            height: 36px;            background: transparent;            border: none;            border-radius: 8px;            cursor: pointer;            display: flex;            align-items: center;            justify-content: center;            color: var(--text);            transition: all 0.2s;        }        .close-settings:hover {            background: var(--bg-user);        }        .settings-section {            margin-bottom: 30px;        }        .settings-section h3 {            font-size: 16px;            color: var(--text);            margin-bottom: 15px;        }        .profile-image-upload {            text-align: center;        }        .profile-preview {            width: 120px;            height: 120px;            margin: 0 auto 20px;            border-radius: 50%;            background: var(--primary);            display: flex;            align-items: center;            justify-content: center;            color: white;            font-size: 48px;            font-weight: bold;            overflow: hidden;            cursor: pointer;            transition: all 0.3s;            border: 4px solid var(--border);        }        .profile-preview:hover {            transform: scale(1.05);            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.3);        }        .profile-preview img {            width: 100%;            height: 100%;            object-fit: cover;        }        .upload-profile-btn {            padding: 10px 20px;            background: linear-gradient(135deg, var(--primary), #ff91af);            border: none;            border-radius: 8px;            color: white;            font-weight: 600;            cursor: pointer;            transition: all 0.3s;        }        .upload-profile-btn:hover {            transform: translateY(-2px);        }        .remove-profile-btn {            margin-left: 10px;            padding: 10px 20px;            background: transparent;            border: 1px solid var(--border);            border-radius: 8px;            color: var(--text);            font-weight: 600;            cursor: pointer;            transition: all 0.3s;        }        .remove-profile-btn:hover {            background: #ffe4e9;        }        .chat-area {            flex: 1;            overflow-y: auto;            padding: 20px;            scroll-behavior: smooth;        }        .chat-area::-webkit-scrollbar {            width: 8px;        }        .chat-area::-webkit-scrollbar-track {            background: transparent;        }        .chat-area::-webkit-scrollbar-thumb {            background: var(--border);            border-radius: 4px;        }        .chat-area::-webkit-scrollbar-thumb:hover {            background: var(--primary);        }        .welcome-screen {            display: flex;            flex-direction: column;            align-items: center;            justify-content: center;            height: 100%;            text-align: center;            gap: 12px;        }        .welcome-screen h2 {            font-size: 36px;            color: var(--primary);            font-weight: 700;        }        .welcome-screen p {            color: #6b4c6f;            font-size: 18px;        }        .messages {            display: none;        }        .messages.show {            display: block;        }        .message {            margin-bottom: 20px;            animation: messageSlideIn 0.3s ease-out;        }        @keyframes messageSlideIn {            from {                opacity: 0;                transform: translateY(10px);            }            to {                opacity: 1;                transform: translateY(0);            }        }        .message-content {            display: flex;            gap: 12px;            align-items: flex-start;        }        .message-avatar {            width: 40px;            height: 40px;            border-radius: 50%;            background: var(--primary);            color: white;            display: flex;            align-items: center;            justify-content: center;            font-weight: bold;            font-size: 16px;            flex-shrink: 0;            overflow: hidden;        }        .message-avatar img {            width: 100%;            height: 100%;            object-fit: cover;        }        .message.user .message-content {            flex-direction: row-reverse;        }        .message.user .message-bubble {            background: #ffe4e9;        }        .message.assistant .message-avatar {            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            font-size: 24px;        }        .message-bubble {            max-width: 75%;            min-width: 60px;            padding: 14px 18px;            border-radius: 16px;            background: white;            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);            line-height: 1.7;            word-wrap: break-word;            word-break: keep-all;            overflow-wrap: break-word;            position: relative;            display: inline-block;        }        .message-actions {            display: none;            gap: 4px;            margin-top: 8px;            padding-top: 8px;            border-top: 1px solid rgba(255, 105, 180, 0.1);        }        .message:hover .message-actions {            display: flex;        }        .action-btn {            background: transparent;            border: 1px solid var(--border);            border-radius: 6px;            padding: 6px 12px;            font-size: 12px;            color: var(--text-light);            cursor: pointer;            transition: all 0.2s;            display: flex;            align-items: center;            gap: 4px;        }        .action-btn:hover {            background: var(--bg-user);            color: var(--primary);            border-color: var(--primary);        }        .action-btn svg {            width: 14px;            height: 14px;        }        .message-bubble p {            margin-bottom: 10px;        }        .message-bubble p:last-child {            margin-bottom: 0;        }        .message-bubble strong {            color: var(--primary);        }        .message-bubble img {            max-width: 100%;            border-radius: 8px;            margin: 10px 0;        }        .typing-cursor {            display: inline-block;            width: 2px;            height: 1em;            background: var(--primary);            margin-left: 2px;            animation: blink 1s infinite;            vertical-align: text-bottom;        }        @keyframes blink {            0%, 49% { opacity: 1; }            50%, 100% { opacity: 0; }        }        .input-area {            padding: 20px;            background: rgba(255, 255, 255, 0.95);            border-top: 1px solid var(--border);            backdrop-filter: blur(10px);        }        .uploaded-file-preview {            max-width: 900px;            margin: 0 auto 10px;            padding: 10px;            background: #ffe4e9;            border-radius: 8px;            display: none;            align-items: center;            gap: 10px;        }        .uploaded-file-preview.show {            display: flex;        }        .file-preview-thumb {            width: 50px;            height: 50px;            border-radius: 6px;            object-fit: cover;            background: white;        }        .file-info {            flex: 1;        }        .file-name {            font-size: 14px;            font-weight: 500;            color: var(--text);        }        .file-size {            font-size: 12px;            color: var(--text-light);        }        .remove-file {            width: 30px;            height: 30px;            background: white;            border: none;            border-radius: 50%;            cursor: pointer;            display: flex;            align-items: center;            justify-content: center;            color: var(--text);            transition: all 0.2s;        }        .remove-file:hover {            background: var(--primary);            color: white;        }        .input-wrapper {            display: flex;            gap: 10px;            max-width: 900px;            margin: 0 auto;            position: relative;        }        .attach-btn {            width: 48px;            height: 48px;            background: transparent;            border: 2px solid var(--border);            border-radius: 12px;            cursor: pointer;            display: flex;            align-items: center;            justify-content: center;            color: var(--primary);            transition: all 0.3s;            flex-shrink: 0;        }        .attach-btn:hover {            background: var(--bg-user);            border-color: var(--primary);        }        .attach-btn svg {            width: 24px;            height: 24px;        }        .upload-menu {            position: absolute;            bottom: 60px;            left: 0;            background: white;            border-radius: 12px;            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.3);            padding: 8px;            display: none;            flex-direction: column;            gap: 4px;            min-width: 180px;            z-index: 50;        }        .upload-menu.show {            display: flex;        }        .upload-option {            padding: 12px 16px;            background: transparent;            border: none;            border-radius: 8px;            cursor: pointer;            display: flex;            align-items: center;            gap: 12px;            font-size: 14px;            color: var(--text);            transition: all 0.2s;            text-align: left;        }        .upload-option:hover {            background: var(--bg-user);        }        .upload-option svg {            width: 20px;            height: 20px;            color: var(--primary);        }        #messageInput {            flex: 1;            padding: 12px 16px;            border: 2px solid var(--border);            border-radius: 12px;            font-size: 15px;            resize: none;            font-family: inherit;            min-height: 48px;            max-height: 150px;            transition: border-color 0.3s;        }        #messageInput:focus {            outline: none;            border-color: var(--primary);            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.1);        }        #sendBtn {            padding: 12px 24px;            background: linear-gradient(135deg, var(--primary), #ff91af);            border: none;            border-radius: 12px;            color: white;            font-weight: 600;            cursor: pointer;            transition: all 0.3s;            white-space: nowrap;            box-shadow: 0 2px 10px rgba(255, 105, 180, 0.3);            flex-shrink: 0;            display: flex;            align-items: center;            justify-content: center;            min-width: 50px;        }        #sendBtn svg {            width: 20px;            height: 20px;        }        #sendBtn:hover:not(:disabled) {            transform: translateY(-2px);            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);        }        #sendBtn:active:not(:disabled) {            transform: translateY(0);        }        #sendBtn:disabled {            opacity: 0.5;            cursor: not-allowed;        }        .loading-dots {            display: inline-flex;            gap: 4px;            padding: 4px 0;        }        .loading-dots span {            width: 8px;            height: 8px;            background: var(--primary);            border-radius: 50%;            animation: bounce 1.4s infinite;        }        .loading-dots span:nth-child(2) {            animation-delay: 0.2s;        }        .loading-dots span:nth-child(3) {            animation-delay: 0.4s;        }        @keyframes bounce {            0%, 60%, 100% {                transform: translateY(0);                opacity: 0.7;            }            30% {                transform: translateY(-8px);                opacity: 1;            }        }        /* Mobile Responsive */        @media (max-width: 768px) {            .sidebar {                width: 100%;                transform: translateX(-100%);            }            .sidebar.open {                transform: translateX(0);            }            .main-content {                margin-left: 0;            }            .message-bubble {                max-width: 85%;            }            .auth-container {                padding: 30px 20px;            }            .settings-panel {                width: 100%;            }        }    </style></head><body>    <!-- Loading Screen -->    <div id="loadingScreen">        <div class="loading-logo">            <img src="https://i.postimg.cc/5y6Qq50Q/circle-cropped.png" alt="MRE AI">        </div>        <div class="loading-text">Loading MRE AI...</div>    </div>    <!-- Auth Wrapper -->    <div id="authWrapper" class="auth-wrapper">        <div class="auth-container">            <!-- Login Form -->            <div id="loginForm">                <div class="auth-header">                    <h1>ü§ñ MRE AI</h1>                    <p>Welcome back! Please login to continue</p>                </div>                                <div id="loginError" class="error-message"></div>                                <button class="google-btn" onclick="handleGoogleLogin()">                    <svg width="20" height="20" viewBox="0 0 48 48">                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>                        <path fill="none" d="M0 0h48v48H0z"/>                    </svg>                    Continue with Google                </button>            </div>            <!-- Signup Form - Removed, only Google Sign-in available -->            <!-- Forgot Password Form - Removed, only Google Sign-in available -->    </div>    <!-- Chat App -->    <div id="chatApp">        <!-- Sidebar Overlay for mobile -->        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>                <div class="sidebar" id="sidebar">            <button class="new-chat-btn" onclick="newChat()">                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                    <path d="M12 5v14M5 12h14"/>                </svg>                New Chat            </button>                        <div class="chat-history-section" id="chatHistorySection">                <h3>üí¨ Chat History</h3>                <div id="chatHistoryList"></div>                <button class="clear-history-btn" onclick="clearAllHistory()" id="clearHistoryBtn" style="display: none;">                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>                    </svg>                    Clear All History                </button>            </div>                        <div class="sidebar-footer">                <div class="user-info">                    <div class="user-avatar" id="userAvatar">U</div>                    <div class="user-details">                        <div class="user-name" id="userName">User</div>                        <div class="user-email" id="userEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="077274627547626a666e6b2964686a">[email&#160;protected]</a></div>                    </div>                </div>                <button class="logout-btn" onclick="logout()">Logout</button>            </div>        </div>        <div class="main-content">            <div class="header">                <div class="header-left">                    <button class="menu-toggle" onclick="toggleSidebar()">                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                            <path d="M3 12h18M3 6h18M3 18h18"/>                        </svg>                    </button>                    <h1>ü§ñ MRE AI Chat</h1>                </div>                <button class="settings-btn" onclick="toggleSettings()">                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>                        <circle cx="12" cy="12" r="3"></circle>                    </svg>                </button>            </div>            <div class="chat-area" id="chatArea">                <div id="welcomeScreen" class="welcome-screen">                    <h2>Hello, <span id="welcomeName">User</span>! üëã</h2>                    <p>How can I help you today?</p>                </div>                                <div id="messages" class="messages"></div>            </div>            <div class="input-area">                <div class="uploaded-file-preview" id="uploadedFilePreview">                    <img class="file-preview-thumb" id="filePreviewThumb" alt="Preview">                    <div class="file-info">                        <div class="file-name" id="fileName">File name</div>                        <div class="file-size" id="fileSize">0 KB</div>                    </div>                    <button class="remove-file" onclick="removeUploadedFile()">                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                            <path d="M18 6L6 18M6 6l12 12"/>                        </svg>                    </button>                </div>                                <div class="input-wrapper">                    <button class="attach-btn" onclick="toggleUploadMenu()">                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                            <path d="M12 5v14M5 12h14"/>                        </svg>                    </button>                                        <div class="upload-menu" id="uploadMenu">                        <button class="upload-option" onclick="triggerCamera()">                            <svg viewBox="0 0 24 24" fill="currentColor">                                <path d="M12 15.5c1.93 0 3.5-1.57 3.5-3.5s-1.57-3.5-3.5-3.5-3.5 1.57-3.5 3.5 1.57 3.5 3.5 3.5z"/>                                <path d="M17.9 6.6l-1.3-1.3c-.4-.4-.9-.6-1.4-.6H8.8c-.5 0-1 .2-1.4.6L6.1 6.6c-.4.4-.6.9-.6 1.4v8c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V8c0-.5-.2-1-.6-1.4z"/>                            </svg>                            Camera                        </button>                        <button class="upload-option" onclick="triggerPhoto()">                            <svg viewBox="0 0 24 24" fill="currentColor">                                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>                            </svg>                            Photo                        </button>                        <button class="upload-option" onclick="triggerFile()">                            <svg viewBox="0 0 24 24" fill="currentColor">                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>                            </svg>                            File                        </button>                    </div>                                        <textarea id="messageInput" rows="1" placeholder="Type your message..." onkeydown="handleKeyPress(event)" oninput="autoResize(this)"></textarea>                    <button id="sendBtn" onclick="sendMessage()" disabled>                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>                        </svg>                    </button>                </div>            </div>        </div>        <!-- Settings Panel -->        <div class="settings-panel" id="settingsPanel">            <div class="settings-header">                <h2>‚öôÔ∏è Settings</h2>                <button class="close-settings" onclick="toggleSettings()">                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                        <path d="M18 6L6 18M6 6l12 12"/>                    </svg>                </button>            </div>            <div class="settings-section">                <h3>Profile Picture</h3>                <div class="profile-image-upload">                    <div class="profile-preview" id="profilePreview" onclick="document.getElementById('profileImageInput').click()">                        <span id="profileInitial">U</span>                    </div>                    <button class="upload-profile-btn" onclick="document.getElementById('profileImageInput').click()">Upload Photo</button>                    <button class="remove-profile-btn" id="removePhotoBtn" onclick="removeProfilePhoto()" style="display: none;">Remove</button>                    <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(event)">                </div>            </div>        </div>    </div>    <!-- Hidden File Inputs -->    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">    <input type="file" id="photoInput" accept="image/*" style="display: none;">    <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx,.txt" style="display: none;">    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>        const API_KEY = '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';        const API_URL = 'https://openrouter.ai/api/v1/chat/completions';        let currentUser = null;        let conversationHistory = [];        let chatHistories = {};        let currentChatId = null;        let uploadedFile = null;        let profileImage = null;        let isResponseGenerating = false;        let abortController = null;        // Language detection function        function detectLanguage(text) {            // Bengali characters range            const bengaliPattern = /[\u0980-\u09FF]/;            // Check if text contains Bengali characters            if (bengaliPattern.test(text)) {                return 'bengali';            }                        // Common Bengali words in English transliteration            const bengaliWords = [                'ami', 'tumi', 'apni', 'kemon', 'achen', 'achi', 'korchi', 'kora', 'korbo',                 'hobe', 'hoyeche', 'ache', 'nai', 'keno', 'ki', 'keno', 'kothai', 'kothay',                'banabo', 'banassi', 'banachi', 'baniyechi', 'korte', 'chai', 'pari', 'parbo',                'jabo', 'jachchi', 'ashbo', 'aschi', 'dekhbo', 'dekhechi', 'bola', 'bolte',                'bolechi', 'shunbo', 'shunechi', 'likha', 'likhbo', 'likhechi', 'khaoa', 'khabo',                'khechi', 'ghum', 'ghumachchhi', 'utchi', 'uthechi', 'boshi', 'bosechi', 'daudabo',                'daudachchhi', 'hashi', 'hastechi', 'kandte', 'kadechi', 'kaj', 'kaaj', 'kori',                'korechi', 'korbo', 'hoyeche', 'hoye', 'gelo', 'giyechi', 'elam', 'esechi',                'amar', 'tomar', 'apnar', 'tar', 'oder', 'amader', 'tomader', 'apnader',                'keu', 'kono', 'kotha', 'kichu', 'kichhu', 'shob', 'sob', 'bhalo', 'valo',                'kharap', 'sundor', 'shundor', 'moja', 'bhoy', 'voy', 'raga', 'khushi',                'dukho', 'dukkho', 'shanti', 'prem', 'valobasha', 'bhalobasha',                // Additional common Banglish words                'aso', 'asho', 'korcho', 'korchho', 'korchis', 'korso', 'koro', 'hoise', 'hoiche',                'geche', 'gese', 'jaccho', 'jachcho', 'jao', 'janina', 'jani', 'bujhina', 'bujhi',                'asche', 'ashche', 'ashbe', 'asbe', 'jabe', 'jacchi', 'thik', 'thakbo', 'thakchi',                'na', 'nah', 'hmm', 'accha', 'acha', 'vai', 'bhai', 'apa', 'bondhu', 'khabar',                'kheyechi', 'dekho', 'ektu', 'onek', 'ase', 'ar', 'ebong', 'tao', 'kintu'            ];                        const words = text.toLowerCase().split(/\s+/);            let bengaliWordCount = 0;                        for (const word of words) {                if (bengaliWords.includes(word)) {                    bengaliWordCount++;                }            }                        // If more than 20% words are Bengali transliteration, consider it Bengali            if (bengaliWordCount > 0 && (bengaliWordCount / words.length) > 0.2) {                return 'bengali';            }                        return 'english';        }        // Create language-aware system prompt        function createSystemPrompt(userMessage) {            const language = detectLanguage(userMessage);                        let languageInstruction = '';            if (language === 'bengali') {                languageInstruction = `IMPORTANT: The user is communicating in Bengali (either in Bengali script or using English transliteration/Banglish). You MUST respond in Bengali script (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ). Do not respond in English. Always use Bengali characters when replying.`;            } else {                languageInstruction = `IMPORTANT: The user is communicating in English. You MUST respond in English only. Do not use Bengali.`;            }                        return `You are a helpful AI assistant. The user's name is ${currentUser.name}. Address them by their name when appropriate and natural in the conversation.${languageInstruction}Examples:- If user writes "ami ekta ai banassi" or "‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶æ AI ‡¶¨‡¶æ‡¶®‡¶æ‡¶ö‡ßç‡¶õ‡¶ø", respond in Bengali: "‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ü‡¶æ AI ‡¶¨‡¶æ‡¶®‡¶æ‡¶ö‡ßç‡¶õ‡ßá‡¶®..."- If user writes "I am building an AI", respond in English: "That's great! You're building an AI..."- If user writes "tumi kemon acho?" or "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßã?", respond in Bengali: "‡¶Ü‡¶Æ‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ü‡¶õ‡¶ø, ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶!"- If user writes "How are you?", respond in English: "I'm doing well, thank you!"Always match the language of the user's message.`;        }        // Hide loading screen after page loads        window.addEventListener('load', () => {            setTimeout(() => {                document.getElementById('loadingScreen').classList.add('hide');                                // Check if user is logged in                const savedUser = localStorage.getItem('currentUser');                const rememberMe = localStorage.getItem('rememberMe') === 'true';                                if (savedUser && rememberMe) {                    currentUser = JSON.parse(savedUser);                    loadUserData();                    showChatApp();                } else {                    localStorage.removeItem('currentUser');                    document.getElementById('authWrapper').classList.add('show');                }            }, 1000);        });        // Load user data        function loadUserData() {            // Load profile image            const savedProfileImage = localStorage.getItem(`profileImage_${currentUser.email}`);            if (savedProfileImage) {                profileImage = savedProfileImage;                updateProfileImages();            }            // Load chat histories            const savedChatHistories = localStorage.getItem(`chatHistories_${currentUser.email}`);            if (savedChatHistories) {                chatHistories = JSON.parse(savedChatHistories);                renderChatHistory();            }        }        // Save chat histories        function saveChatHistories() {            localStorage.setItem(`chatHistories_${currentUser.email}`, JSON.stringify(chatHistories));        }        // Render chat history list        function renderChatHistory() {            const historyList = document.getElementById('chatHistoryList');            const clearBtn = document.getElementById('clearHistoryBtn');            historyList.innerHTML = '';            const chatIds = Object.keys(chatHistories).sort((a, b) => {                return chatHistories[b].timestamp - chatHistories[a].timestamp;            });            if (chatIds.length === 0) {                historyList.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b4c6f; font-size: 13px;">No chat history yet</div>';                clearBtn.style.display = 'none';                return;            }            clearBtn.style.display = 'flex';            chatIds.forEach(chatId => {                const chat = chatHistories[chatId];                const item = document.createElement('div');                item.className = 'chat-history-item' + (chatId === currentChatId ? ' active' : '');                                const title = document.createElement('span');                title.className = 'chat-title';                title.textContent = chat.title || 'New Chat';                title.onclick = () => loadChat(chatId);                                const deleteBtn = document.createElement('button');                deleteBtn.className = 'delete-chat-btn';                deleteBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                    <path d="M18 6L6 18M6 6l12 12"/>                </svg>`;                deleteBtn.onclick = (e) => {                    e.stopPropagation();                    deleteChat(chatId);                };                                item.appendChild(title);                item.appendChild(deleteBtn);                historyList.appendChild(item);            });        }        // Delete a single chat        function deleteChat(chatId) {            if (confirm('‡¶è‡¶á chat ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®? / Delete this chat?')) {                delete chatHistories[chatId];                saveChatHistories();                                if (chatId === currentChatId) {                    newChat();                } else {                    renderChatHistory();                }            }        }        // Clear all chat history        function clearAllHistory() {            if (confirm('‡¶∏‡¶¨ chat history ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®? ‡¶è‡¶ü‡¶ø undo ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ! / Delete all chat history? This cannot be undone!')) {                chatHistories = {};                saveChatHistories();                newChat();            }        }        // Load a chat        function loadChat(chatId) {            // ‡¶Ø‡¶¶‡¶ø response ‡¶ö‡¶≤‡¶õ‡¶ø‡¶≤, stop ‡¶ï‡¶∞‡ßã            if (isResponseGenerating) {                stopResponse();            }                        currentChatId = chatId;            conversationHistory = chatHistories[chatId].messages || [];                        // Clear and redisplay messages            document.getElementById('welcomeScreen').style.display = 'none';            document.getElementById('messages').classList.add('show');            document.getElementById('messages').innerHTML = '';                        conversationHistory.forEach(msg => {                if (msg.role === 'user' || msg.role === 'assistant') {                    addMessage(msg.content, msg.role === 'user' ? 'user' : 'assistant', true);                }            });                        renderChatHistory();                        // Close sidebar on mobile after selecting            if (window.innerWidth <= 768) {                toggleSidebar();            }        }        // Save current chat        function saveCurrentChat() {            if (!currentChatId) {                currentChatId = 'chat_' + Date.now();            }            // Get title from first user message            const firstUserMsg = conversationHistory.find(m => m.role === 'user');            const title = firstUserMsg ? firstUserMsg.content.substring(0, 50) : 'New Chat';            chatHistories[currentChatId] = {                title: title,                messages: conversationHistory,                timestamp: Date.now()            };            saveChatHistories();            renderChatHistory();        }        // Profile image upload        function handleProfileImageUpload(event) {            const file = event.target.files[0];            if (file && file.type.startsWith('image/')) {                const reader = new FileReader();                reader.onload = (e) => {                    profileImage = e.target.result;                    localStorage.setItem(`profileImage_${currentUser.email}`, profileImage);                    updateProfileImages();                    document.getElementById('removePhotoBtn').style.display = 'inline-block';                };                reader.readAsDataURL(file);            }        }        function removeProfilePhoto() {            profileImage = null;            localStorage.removeItem(`profileImage_${currentUser.email}`);            updateProfileImages();            document.getElementById('removePhotoBtn').style.display = 'none';        }        function updateProfileImages() {            const initial = currentUser.name.charAt(0).toUpperCase();                        // Update all profile displays            const avatars = [                document.getElementById('userAvatar'),                document.getElementById('profilePreview')            ];            avatars.forEach(avatar => {                if (profileImage) {                    avatar.innerHTML = `<img src="${profileImage}" alt="Profile">`;                } else {                    avatar.innerHTML = `<span>${initial}</span>`;                    if (avatar.id === 'profilePreview') {                        avatar.querySelector('span').id = 'profileInitial';                    }                }            });        }        // File upload functions        function toggleUploadMenu() {            document.getElementById('uploadMenu').classList.toggle('show');        }        function triggerCamera() {            document.getElementById('cameraInput').click();            toggleUploadMenu();        }        function triggerPhoto() {            document.getElementById('photoInput').click();            toggleUploadMenu();        }        function triggerFile() {            document.getElementById('fileInput').click();            toggleUploadMenu();        }        // Handle file uploads        document.getElementById('cameraInput').addEventListener('change', handleFileSelect);        document.getElementById('photoInput').addEventListener('change', handleFileSelect);        document.getElementById('fileInput').addEventListener('change', handleFileSelect);        function handleFileSelect(event) {            const file = event.target.files[0];            if (file) {                uploadedFile = file;                displayFilePreview(file);            }        }        function displayFilePreview(file) {            const preview = document.getElementById('uploadedFilePreview');            const thumb = document.getElementById('filePreviewThumb');            const fileName = document.getElementById('fileName');            const fileSize = document.getElementById('fileSize');            if (file.type.startsWith('image/')) {                const reader = new FileReader();                reader.onload = (e) => {                    thumb.src = e.target.result;                };                reader.readAsDataURL(file);            } else {                thumb.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff69b4"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z"/></svg>';            }            fileName.textContent = file.name;            fileSize.textContent = (file.size / 1024).toFixed(2) + ' KB';            preview.classList.add('show');                        // Update button state properly            if (!isResponseGenerating) {                updateSendButton();            }        }        function removeUploadedFile() {            uploadedFile = null;            document.getElementById('uploadedFilePreview').classList.remove('show');            document.getElementById('cameraInput').value = '';            document.getElementById('photoInput').value = '';            document.getElementById('fileInput').value = '';                        // Update button state properly            if (!isResponseGenerating) {                updateSendButton();            }        }        // Click outside to close menus        document.addEventListener('click', (e) => {            const uploadMenu = document.getElementById('uploadMenu');            const attachBtn = document.querySelector('.attach-btn');                        if (!uploadMenu.contains(e.target) && !attachBtn.contains(e.target)) {                uploadMenu.classList.remove('show');            }        });        // Settings        function toggleSettings() {            document.getElementById('settingsPanel').classList.toggle('open');        }        // Toggle sidebar for mobile        function toggleSidebar() {            const sidebar = document.getElementById('sidebar');            const overlay = document.getElementById('sidebarOverlay');                        sidebar.classList.toggle('open');            overlay.classList.toggle('show');        }        // Show/Hide Forms        function showLogin() {            document.getElementById('loginForm').classList.remove('hide');            document.getElementById('signupForm').classList.add('hide');            document.getElementById('forgotForm').classList.add('hide');            clearMessages();        }        function showSignup() {            document.getElementById('loginForm').classList.add('hide');            document.getElementById('signupForm').classList.remove('hide');            document.getElementById('forgotForm').classList.add('hide');            clearMessages();        }        function showForgotPassword() {            document.getElementById('loginForm').classList.add('hide');            document.getElementById('signupForm').classList.add('hide');            document.getElementById('forgotForm').classList.remove('hide');            clearMessages();        }        function clearMessages() {            document.querySelectorAll('.error-message, .success-message').forEach(el => {                el.style.display = 'none';                el.textContent = '';            });        }        // Signup        function signup(e) {            e.preventDefault();                        const name = document.getElementById('signupName').value.trim();            const email = document.getElementById('signupEmail').value.trim().toLowerCase();            const password = document.getElementById('signupPassword').value;            if (!name || !email || !password) {                showError('signupError', '‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®! / Please fill all fields!');                return false;            }            let users = JSON.parse(localStorage.getItem('users') || '[]');            if (users.find(u => u.email === email)) {                showError('signupError', '‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶Ü‡¶õ‡ßá! / Email already registered!');                return false;            }            users.push({ name, email, password });            localStorage.setItem('users', JSON.stringify(users));            showSuccess('signupSuccess', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! / Account created successfully!');                        setTimeout(() => {                showLogin();                document.getElementById('loginEmail').value = email;            }, 1500);            return false;        }        // Google Login Configuration        const GOOGLE_CLIENT_ID = '126547422669-6sudot1o56a6rl27prnu1fa3n1t5ci1u.apps.googleusercontent.com'; // Replace with your actual Google Client ID        // Initialize Google Sign-In        function initGoogleSignIn() {            if (typeof google !== 'undefined' && google.accounts) {                google.accounts.id.initialize({                    client_id: GOOGLE_CLIENT_ID,                    callback: handleGoogleCallback                });            }        }        // Handle Google Login Button Click        function handleGoogleLogin() {            if (typeof google === 'undefined' || !google.accounts) {                alert('Google Sign-In is loading. Please wait a moment and try again.');                return;            }            google.accounts.id.prompt(); // Show One Tap dialog        }        // Handle Google Sign-In Callback        function handleGoogleCallback(response) {            try {                // Decode the JWT token                const token = response.credential;                const base64Url = token.split('.')[1];                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);                }).join(''));                                const userData = JSON.parse(jsonPayload);                                // Extract user information                const googleUser = {                    name: userData.name,                    email: userData.email,                    picture: userData.picture,                    googleId: userData.sub,                    provider: 'google'                };                // Check if user exists                let users = JSON.parse(localStorage.getItem('users') || '[]');                let existingUser = users.find(u => u.email === googleUser.email);                if (existingUser) {                    // Update existing user with Google info if not already set                    if (!existingUser.googleId) {                        existingUser.googleId = googleUser.googleId;                        existingUser.provider = 'google';                        existingUser.picture = googleUser.picture;                        localStorage.setItem('users', JSON.stringify(users));                    }                    currentUser = existingUser;                } else {                    // Create new user                    const newUser = {                        name: googleUser.name,                        email: googleUser.email,                        password: 'google_auth_' + googleUser.googleId, // Placeholder password                        googleId: googleUser.googleId,                        provider: 'google',                        picture: googleUser.picture                    };                    users.push(newUser);                    localStorage.setItem('users', JSON.stringify(users));                    currentUser = newUser;                }                // Save Google profile picture                if (googleUser.picture) {                    localStorage.setItem(`profileImage_${currentUser.email}`, googleUser.picture);                    profileImage = googleUser.picture;                }                // Save current user and show chat                localStorage.setItem('currentUser', JSON.stringify(currentUser));                localStorage.setItem('rememberMe', true);                                loadUserData();                showChatApp();                            } catch (error) {                console.error('Google Sign-In Error:', error);                alert('‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶∏‡¶æ‡¶á‡¶®-‡¶á‡¶® ‡¶è ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ / Error with Google Sign-In. Please try again.');            }        }        // Login        function login(e) {            e.preventDefault();                        const email = document.getElementById('loginEmail').value.trim().toLowerCase();            const password = document.getElementById('loginPassword').value;            const rememberMe = document.getElementById('rememberMe').checked;            const users = JSON.parse(localStorage.getItem('users') || '[]');            const user = users.find(u => u.email === email && u.password === password);            if (!user) {                showError('loginError', '‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°! / Invalid email or password!');                return false;            }            currentUser = user;            localStorage.setItem('currentUser', JSON.stringify(user));            localStorage.setItem('rememberMe', rememberMe);                        loadUserData();            showChatApp();            return false;        }        // Forgot Password        function forgotPassword(e) {            e.preventDefault();                        const email = document.getElementById('forgotEmail').value.trim().toLowerCase();            const newPassword = document.getElementById('newPassword').value;            let users = JSON.parse(localStorage.getItem('users') || '[]');            const userIndex = users.findIndex(u => u.email === email);            if (userIndex === -1) {                showError('forgotError', '‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø! / Email not found!');                return false;            }            users[userIndex].password = newPassword;            localStorage.setItem('users', JSON.stringify(users));            showSuccess('forgotSuccess', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶∏‡¶´‡¶≤! / Password reset successful!');                        setTimeout(() => {                showLogin();                document.getElementById('loginEmail').value = email;            }, 1500);            return false;        }        // Logout        function logout() {            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? / Are you sure you want to logout?')) {                // ‡¶Ø‡¶¶‡¶ø response ‡¶ö‡¶≤‡¶õ‡¶ø‡¶≤, stop ‡¶ï‡¶∞‡ßã                if (isResponseGenerating) {                    stopResponse();                }                                localStorage.removeItem('currentUser');                localStorage.removeItem('rememberMe');                currentUser = null;                conversationHistory = [];                chatHistories = {};                currentChatId = null;                profileImage = null;                isResponseGenerating = false;                abortController = null;                                document.getElementById('chatApp').classList.remove('show');                document.getElementById('authWrapper').classList.add('show');                                document.getElementById('welcomeScreen').style.display = 'flex';                document.getElementById('messages').classList.remove('show');                document.getElementById('messages').innerHTML = '';                document.getElementById('messageInput').value = '';                                showLogin();            }        }        // Show Chat App        function showChatApp() {            document.getElementById('authWrapper').classList.remove('show');            document.getElementById('chatApp').classList.add('show');                        const firstLetter = currentUser.name.charAt(0).toUpperCase();            document.getElementById('userName').textContent = currentUser.name;            document.getElementById('userEmail').textContent = currentUser.email;            document.getElementById('welcomeName').textContent = currentUser.name;                        updateProfileImages();        }        // Error/Success Messages        function showError(elementId, message) {            const el = document.getElementById(elementId);            el.textContent = message;            el.style.display = 'block';            setTimeout(() => el.style.display = 'none', 4000);        }        function showSuccess(elementId, message) {            const el = document.getElementById(elementId);            el.textContent = message;            el.style.display = 'block';        }        // Chat Functions        function handleKeyPress(e) {            if (e.key === 'Enter' && !e.shiftKey) {                e.preventDefault();                if (!document.getElementById('sendBtn').disabled) {                    sendMessage();                }            }        }        function autoResize(textarea) {            textarea.style.height = 'auto';            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';                        // ‡¶Ø‡¶¶‡¶ø response generate ‡¶π‡¶ö‡ßç‡¶õ‡ßá, button disable ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ            if (!isResponseGenerating) {                const sendBtn = document.getElementById('sendBtn');                sendBtn.disabled = !textarea.value.trim() && !uploadedFile;            }        }        function newChat() {            if (conversationHistory.length > 0) {                saveCurrentChat();            }                        // ‡¶Ø‡¶¶‡¶ø response ‡¶ö‡¶≤‡¶õ‡¶ø‡¶≤, ‡¶§‡¶æ‡¶π‡¶≤‡ßá stop ‡¶ï‡¶∞‡ßã            if (isResponseGenerating) {                stopResponse();            }                        currentChatId = null;            conversationHistory = [];            document.getElementById('welcomeScreen').style.display = 'flex';            document.getElementById('messages').classList.remove('show');            document.getElementById('messages').innerHTML = '';            document.getElementById('messageInput').value = '';            document.getElementById('messageInput').style.height = 'auto';                        // Reset button state            isResponseGenerating = false;            abortController = null;            updateSendButton();                        renderChatHistory();                        // Close sidebar on mobile after creating new chat            if (window.innerWidth <= 768) {                const sidebar = document.getElementById('sidebar');                const overlay = document.getElementById('sidebarOverlay');                if (sidebar.classList.contains('open')) {                    toggleSidebar();                }            }        }        async function resendEditedMessage(message) {            if (isResponseGenerating) {                return;            }            document.getElementById('welcomeScreen').style.display = 'none';            document.getElementById('messages').classList.add('show');            // Response generate ‡¶∂‡ßÅ‡¶∞‡ßÅ            isResponseGenerating = true;            updateSendButton();            const loadingId = addMessage('<div class="loading-dots"><span></span><span></span><span></span></div>', 'assistant');            let fullResponse = '';            abortController = new AbortController();            try {                const messagesWithContext = [                    {                        role: 'system',                        content: createSystemPrompt(message)                    },                    ...conversationHistory                ];                // Detect if this is an image generation request                const isImageRequest = detectImageRequest(message);                                // If it's an image generation request, use Pollinations AI                if (isImageRequest) {                    await generateImageWithPollinations(message, loadingId);                    return;                }                                const modelToUse = 'arcee-ai/trinity-large-preview:free';                                const response = await fetch(API_URL, {                    method: 'POST',                    headers: {                        'Content-Type': 'application/json',                        'Authorization': `Bearer ${API_KEY}`,                        'HTTP-Referer': window.location.href,                        'X-Title': 'MRE AI Chat'                    },                    body: JSON.stringify({                        model: modelToUse,                        messages: messagesWithContext,                        temperature: 0.7,                        max_tokens: 2048,                        stream: true                    }),                    signal: abortController.signal                });                if (!response.ok) {                    throw new Error(`API error: ${response.status}`);                }                const reader = response.body.getReader();                const decoder = new TextDecoder();                                updateMessage(loadingId, '<span class="typing-cursor"></span>');                while (true) {                    const { done, value } = await reader.read();                    if (done) break;                    const chunk = decoder.decode(value);                    const lines = chunk.split('\n');                    for (const line of lines) {                        if (line.startsWith('data: ')) {                            const data = line.slice(6);                            if (data === '[DONE]') continue;                                                        try {                                const parsed = JSON.parse(data);                                                                // Check multiple possible response formats                                let content = parsed.choices?.[0]?.delta?.content;                                                                // Alternative formats for different models                                if (!content) {                                    content = parsed.choices?.[0]?.message?.content;                                }                                if (!content && parsed.content) {                                    content = parsed.content;                                }                                if (!content && parsed.text) {                                    content = parsed.text;                                }                                                                if (content) {                                    fullResponse += content;                                    updateMessage(loadingId, formatMessage(fullResponse) + '<span class="typing-cursor"></span>');                                                                        const chatArea = document.getElementById('chatArea');                                    chatArea.scrollTop = chatArea.scrollHeight;                                }                            } catch (e) {                                console.error('Parse error:', e);                                // Skip invalid JSON                            }                        }                    }                }                updateMessage(loadingId, formatMessage(fullResponse));                conversationHistory.push({                    role: 'assistant',                    content: fullResponse                });                saveCurrentChat();            } catch (error) {                if (error.name === 'AbortError') {                    if (fullResponse && fullResponse.trim()) {                        updateMessage(loadingId, formatMessage(fullResponse) + '<p style="color: #999; font-size: 0.85em; font-style: italic; margin-top: 8px;">Response stopped</p>');                        conversationHistory.push({                            role: 'assistant',                            content: fullResponse                        });                        saveCurrentChat();                    } else {                        updateMessage(loadingId, '<p style="color: #999; font-style: italic;">Response stopped by user.</p>');                    }                } else {                    updateMessage(loadingId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üôè<br>Sorry, an error occurred. Please try again.');                    console.error('Error:', error);                }            } finally {                isResponseGenerating = false;                abortController = null;                updateSendButton();            }        }        // Detect if user wants to generate an image        // Generate image using OpenRouter's image generation model        async function generateImageWithPollinations(prompt, messageId) {            try {                // Clean the prompt                let cleanPrompt = prompt                    .replace(/generate|create|make|draw|design|show|genrate|genaret/gi, '')                    .replace(/picture|image|photo|chobi|chhobi|pic|foto|‡¶õ‡¶¨‡¶ø|‡¶á‡¶Æ‡ßá‡¶ú|‡¶´‡¶ü‡ßã/gi, '')                    .replace(/\s+of\s+|\s+‡¶è‡¶∞\s+|‡¶è‡¶ï‡¶ü‡¶æ\s+|‡¶è‡¶ï‡¶ü‡¶ø\s+|a\s+|an\s+|the\s+/gi, ' ')                    .replace(/banao|toiri|aka|dekha|‡¶¨‡¶æ‡¶®‡¶æ‡¶ì|‡¶§‡ßà‡¶∞‡¶ø\s+‡¶ï‡¶∞|‡¶Ü‡¶Å‡¶ï‡¶æ|‡¶Ü‡¶Å‡¶ï/gi, '')                    .trim();                                if (cleanPrompt.length < 2) {                    cleanPrompt = prompt;                }                                // Show generating message                updateMessage(messageId, `                    <div style="text-align: center; padding: 30px;">                        <div class="loading-dots"><span></span><span></span><span></span></div>                        <p style="margin-top: 15px; color: var(--text-light); font-size: 1.1em;">                            üé® ‡¶õ‡¶¨‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...<br>                            <span style="font-size: 0.9em;">Creating: "${cleanPrompt}"</span>                        </p>                        <p style="margin-top: 8px; font-size: 0.85em; color: #999;">                            This may take 10-15 seconds...                        </p>                    </div>                `);                                // Use OpenRouter with a text-to-image model                const response = await fetch(API_URL, {                    method: 'POST',                    headers: {                        'Content-Type': 'application/json',                        'Authorization': `Bearer ${API_KEY}`,                        'HTTP-Referer': window.location.href,                        'X-Title': 'MRE AI Chat'                    },                    body: JSON.stringify({                        model: 'black-forest-labs/flux-1.1-pro',  // Image generation model on OpenRouter                        prompt: cleanPrompt,                        width: 1024,                        height: 1024,                        steps: 20                    })                });                if (!response.ok) {                    throw new Error(`API error: ${response.status}`);                }                const data = await response.json();                                // Check if we got an image URL                if (data.data && data.data[0] && data.data[0].url) {                    const imageUrl = data.data[0].url;                                        const imageHtml = `                        <div style="max-width: 100%; margin: 10px 0;">                            <img src="${imageUrl}"                                  alt="${cleanPrompt}"                                  style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: block;"                                 onload="this.style.opacity='1'; this.previousElementSibling.style.display='none';"                                 style="opacity: 0; transition: opacity 0.3s;">                            <p style="margin-top: 12px; font-size: 0.95em; color: var(--text-light); font-style: italic;">                                ‚ú® <strong>"${cleanPrompt}"</strong>                            </p>                            <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">                                <a href="${imageUrl}" download="ai-generated-${cleanPrompt.replace(/[^a-z0-9]/gi, '-')}.png"                                    style="padding: 10px 18px; background: var(--primary); color: white; text-decoration: none; border-radius: 8px; font-size: 0.9em; display: inline-flex; align-items: center; gap: 6px;">                                    üì• Download                                </a>                                <button onclick="                                    const input = document.getElementById('messageInput');                                    input.value = 'generate a picture of ${cleanPrompt}';                                    document.querySelector('.send-btn').click();                                " style="padding: 10px 18px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em; display: inline-flex; align-items: center; gap: 6px;">                                    üîÑ Regenerate                                </button>                            </div>                        </div>                    `;                                        updateMessage(messageId, imageHtml);                } else {                    throw new Error('No image URL in response');                }                                conversationHistory.push({                    role: 'assistant',                    content: `Generated image: "${cleanPrompt}"`                });                                saveCurrentChat();                            } catch (error) {                console.error('Image generation error:', error);                                // Fallback: Use a simpler free API that definitely works                const cleanPrompt = prompt                    .replace(/generate|create|make|draw|picture|image|photo|of|genrate/gi, '')                    .trim() || prompt;                                const timestamp = Date.now();                const seed = Math.floor(Math.random() * 100000);                                // This URL format definitely works - tested                const fallbackUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(cleanPrompt)}?width=1024&height=1024&seed=${seed}&nologo=true&enhance=true`;                                const imageHtml = `                    <div style="max-width: 100%; margin: 10px 0;">                        <img src="${fallbackUrl}"                              alt="${cleanPrompt}"                              style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: block;"                             crossorigin="anonymous">                        <p style="margin-top: 12px; font-size: 0.95em; color: var(--text-light); font-style: italic;">                            ‚ú® <strong>"${cleanPrompt}"</strong>                        </p>                        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">                            <a href="${fallbackUrl}" download="ai-image.png"                                style="padding: 10px 18px; background: var(--primary); color: white; text-decoration: none; border-radius: 8px; font-size: 0.9em;">                                üì• Download                            </a>                            <button onclick="                                const parent = this.parentElement.parentElement;                                const newSeed = Math.floor(Math.random() * 100000);                                const newUrl = 'https://image.pollinations.ai/prompt/${encodeURIComponent(cleanPrompt)}?width=1024&height=1024&seed=' + newSeed + '&nologo=true&enhance=true';                                const img = parent.querySelector('img');                                img.src = newUrl;                                parent.querySelector('a').href = newUrl;                            " style="padding: 10px 18px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em;">                                üîÑ Regenerate                            </button>                        </div>                    </div>                `;                                updateMessage(messageId, imageHtml);                                conversationHistory.push({                    role: 'assistant',                    content: `Generated image: "${cleanPrompt}"`                });                                saveCurrentChat();            } finally {                isResponseGenerating = false;                abortController = null;                updateSendButton();            }        }        function detectImageRequest(message) {            const lowerMsg = message.toLowerCase();                        // Bengali patterns            const bengaliPatterns = [                'picture', 'image', 'photo', 'chobi', 'chhobi', 'pic', 'foto',                '‡¶õ‡¶¨‡¶ø', '‡¶á‡¶Æ‡ßá‡¶ú', '‡¶´‡¶ü‡ßã', '‡¶õ‡¶¨‡¶ø‡¶ü‡¶ø',                'draw', 'aka', '‡¶Ü‡¶Å‡¶ï‡¶æ', '‡¶Ü‡¶Å‡¶ï', '‡¶Ü‡¶ï‡¶æ',                'create image', 'make image', 'generate image',                'banao', '‡¶¨‡¶æ‡¶®‡¶æ‡¶ì', '‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞', 'toiri koro',                'design', 'dizain', '‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®'            ];                        const verbs = [                'generate', 'create', 'make', 'draw', 'design', 'show',                'banao', 'toiri', 'aka', 'dekha', 'genrate', 'genaret'            ];                        // Check if message contains image-related keywords            for (const pattern of bengaliPatterns) {                if (lowerMsg.includes(pattern)) {                    // Also check if there's a verb suggesting creation                    for (const verb of verbs) {                        if (lowerMsg.includes(verb)) {                            return true;                        }                    }                    // Or direct phrases                    if (lowerMsg.includes('picture of') ||                         lowerMsg.includes('image of') ||                        lowerMsg.includes('photo of') ||                        lowerMsg.includes('chobi banao') ||                        lowerMsg.includes('‡¶õ‡¶¨‡¶ø ‡¶¨‡¶æ‡¶®‡¶æ‡¶ì') ||                        lowerMsg.includes('‡¶è‡¶ï‡¶ü‡¶æ ‡¶õ‡¶¨‡¶ø')) {                        return true;                    }                }            }                        return false;        }        async function sendMessage() {            // ‡¶Ø‡¶¶‡¶ø response generate ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá stop ‡¶ï‡¶∞‡ßã            if (isResponseGenerating) {                stopResponse();                return;            }            const input = document.getElementById('messageInput');            const message = input.value.trim();            if (!message && !uploadedFile) return;            document.getElementById('welcomeScreen').style.display = 'none';            document.getElementById('messages').classList.add('show');            let userMessage = message || 'Uploaded a file';            if (uploadedFile) {                userMessage = message ? `${message} [üìé ${uploadedFile.name}]` : `üìé ${uploadedFile.name}`;            }            addMessage(userMessage, 'user');            conversationHistory.push({                role: 'user',                content: message || 'Please analyze this file'            });            input.value = '';            input.style.height = 'auto';            if (uploadedFile) {                removeUploadedFile();            }            // Response generate ‡¶∂‡ßÅ‡¶∞‡ßÅ - button "Stop" ‡¶è ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßã            isResponseGenerating = true;            updateSendButton();            const loadingId = addMessage('<div class="loading-dots"><span></span><span></span><span></span></div>', 'assistant');            let fullResponse = '';            // ‡¶®‡¶§‡ßÅ‡¶® AbortController ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßã            abortController = new AbortController();            try {                const messagesWithContext = [                    {                        role: 'system',                        content: createSystemPrompt(message)                    },                    ...conversationHistory                ];                // Detect if this is an image generation request                const isImageRequest = detectImageRequest(message);                                // If it's an image generation request, use Pollinations AI                if (isImageRequest) {                    await generateImageWithPollinations(message, loadingId);                    return;                }                                const modelToUse = 'arcee-ai/trinity-large-preview:free';                                const response = await fetch(API_URL, {                    method: 'POST',                    headers: {                        'Content-Type': 'application/json',                        'Authorization': `Bearer ${API_KEY}`,                        'HTTP-Referer': window.location.href,                        'X-Title': 'MRE AI Chat'                    },                    body: JSON.stringify({                        model: modelToUse,                        messages: messagesWithContext,                        temperature: 0.7,                        max_tokens: 2048,                        stream: true                    }),                    signal: abortController.signal                });                if (!response.ok) {                    throw new Error(`API error: ${response.status}`);                }                // Handle streaming response                const reader = response.body.getReader();                const decoder = new TextDecoder();                                // Replace loading with empty message and cursor                updateMessage(loadingId, '<span class="typing-cursor"></span>');                while (true) {                    const { done, value } = await reader.read();                    if (done) {                        break;                    }                    const chunk = decoder.decode(value);                    const lines = chunk.split('\n');                    for (const line of lines) {                        if (line.startsWith('data: ')) {                            const data = line.slice(6);                            if (data === '[DONE]') continue;                                                        try {                                const parsed = JSON.parse(data);                                                                // Check multiple possible response formats                                let content = parsed.choices?.[0]?.delta?.content;                                                                // Alternative formats for different models                                if (!content) {                                    content = parsed.choices?.[0]?.message?.content;                                }                                if (!content && parsed.content) {                                    content = parsed.content;                                }                                if (!content && parsed.text) {                                    content = parsed.text;                                }                                                                if (content) {                                    fullResponse += content;                                    // Show text with cursor while streaming                                    updateMessage(loadingId, formatMessage(fullResponse) + '<span class="typing-cursor"></span>');                                                                        // Auto scroll                                    const chatArea = document.getElementById('chatArea');                                    chatArea.scrollTop = chatArea.scrollHeight;                                }                            } catch (e) {                                console.error('Parse error:', e);                                // Skip invalid JSON                            }                        }                    }                }                // Remove cursor when done                if (fullResponse && fullResponse.trim()) {                    updateMessage(loadingId, formatMessage(fullResponse));                    conversationHistory.push({                        role: 'assistant',                        content: fullResponse                    });                } else {                    updateMessage(loadingId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡ßã‡¶®‡ßã response ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üôè<br>Sorry, no response received. Please try again.');                }                saveCurrentChat();            } catch (error) {                if (error.name === 'AbortError') {                    // Response ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá                    // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ response ‡¶è‡¶∏‡ßá ‡¶•‡¶æ‡¶ï‡ßá, ‡¶∏‡ßá‡¶ü‡¶æ show ‡¶ï‡¶∞‡ßã (cursor ‡¶õ‡¶æ‡¶°‡¶º‡¶æ)                    if (fullResponse && fullResponse.trim()) {                        updateMessage(loadingId, formatMessage(fullResponse) + '<p style="color: #999; font-size: 0.85em; font-style: italic; margin-top: 8px;">Response stopped</p>');                        conversationHistory.push({                            role: 'assistant',                            content: fullResponse                        });                        saveCurrentChat();                    } else {                        // ‡¶ï‡ßã‡¶®‡ßã response ‡¶Ü‡¶∏‡ßá‡¶®‡¶ø, loading dots remove ‡¶ï‡¶∞‡ßã                        updateMessage(loadingId, '<p style="color: #999; font-style: italic;">Response stopped by user.</p>');                    }                } else {                    // Other errors                    updateMessage(loadingId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üôè<br>Sorry, an error occurred. Please try again.');                    console.error('Error:', error);                }            } finally {                // Response ‡¶∂‡ßá‡¶∑ - button ‡¶Ü‡¶¨‡¶æ‡¶∞ send mode ‡¶è                isResponseGenerating = false;                abortController = null;                updateSendButton();            }        }        function stopResponse() {            if (abortController) {                abortController.abort();            }        }        function updateSendButton() {            const sendBtn = document.getElementById('sendBtn');            const input = document.getElementById('messageInput');                        if (isResponseGenerating) {                // Stop button mode                sendBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">                    <rect x="6" y="6" width="12" height="12" rx="1"/>                </svg>`;                sendBtn.disabled = false;                sendBtn.style.background = 'linear-gradient(135deg, #ff4444, #ff6666)';                sendBtn.style.boxShadow = '0 2px 10px rgba(255, 68, 68, 0.3)';            } else {                // Send button mode                sendBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>                </svg>`;                sendBtn.disabled = !input.value.trim() && !uploadedFile;                sendBtn.style.background = '';                sendBtn.style.boxShadow = '';            }        }        function formatMessage(text) {            let formatted = text                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')                .replace(/\*(.*?)\*/g, '<em>$1</em>')                .replace(/\n\n/g, '</p><p>')                .replace(/\n/g, '<br>');                        return '<p>' + formatted + '</p>';        }        function addMessage(text, type, noScroll = false) {            const messagesDiv = document.getElementById('messages');            const messageId = 'msg-' + Date.now();            let avatar;            if (type === 'user') {                if (profileImage) {                    avatar = `<div class="message-avatar"><img src="${profileImage}" alt="You"></div>`;                } else {                    const initial = currentUser.name.charAt(0).toUpperCase();                    avatar = `<div class="message-avatar">${initial}</div>`;                }            } else {                avatar = `<div class="message-avatar">ü§ñ</div>`;            }            // Action buttons ‡¶∂‡ßÅ‡¶ß‡ßÅ user ‡¶è‡¶¨‡¶Ç assistant messages ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø            let actionsHTML = '';            if (type === 'user') {                actionsHTML = `                    <div class="message-actions">                        <button class="action-btn" onclick="editMessage('${messageId}')" title="Edit message">                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>                            </svg>                            Edit                        </button>                    </div>                `;            } else if (type === 'assistant') {                actionsHTML = `                    <div class="message-actions">                        <button class="action-btn" onclick="regenerateResponse('${messageId}')" title="Regenerate response">                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>                            </svg>                            Regenerate                        </button>                        <button class="action-btn" onclick="copyMessage('${messageId}')" title="Copy message">                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>                            </svg>                            Copy                        </button>                    </div>                `;            }            const messageHTML = `                <div class="message ${type}" id="${messageId}" data-text="${type === 'user' ? text.replace(/"/g, '&quot;') : ''}">                    <div class="message-content">                        ${avatar}                        <div>                            <div class="message-bubble">${text}</div>                            ${actionsHTML}                        </div>                    </div>                </div>            `;            messagesDiv.insertAdjacentHTML('beforeend', messageHTML);                        if (!noScroll) {                setTimeout(() => {                    const chatArea = document.getElementById('chatArea');                    chatArea.scrollTo({                        top: chatArea.scrollHeight,                        behavior: 'smooth'                    });                }, 100);            }            return messageId;        }        function updateMessage(messageId, text) {            const messageElement = document.getElementById(messageId);            if (messageElement) {                const bubble = messageElement.querySelector('.message-bubble');                if (bubble) {                    bubble.innerHTML = text;                }            }        }        // Edit message function        function editMessage(messageId) {            const messageElement = document.getElementById(messageId);            if (!messageElement) return;            const bubble = messageElement.querySelector('.message-bubble');            const originalText = messageElement.getAttribute('data-text');                        if (!originalText) return;            // Create textarea for editing            const textarea = document.createElement('textarea');            textarea.value = originalText;            textarea.style.width = '100%';            textarea.style.minHeight = '60px';            textarea.style.padding = '8px';            textarea.style.border = '2px solid var(--primary)';            textarea.style.borderRadius = '8px';            textarea.style.fontFamily = 'inherit';            textarea.style.fontSize = '15px';            textarea.style.resize = 'vertical';            // Create buttons            const buttonsDiv = document.createElement('div');            buttonsDiv.style.display = 'flex';            buttonsDiv.style.gap = '8px';            buttonsDiv.style.marginTop = '8px';            const saveBtn = document.createElement('button');            saveBtn.textContent = 'Save';            saveBtn.className = 'action-btn';            saveBtn.style.background = 'var(--primary)';            saveBtn.style.color = 'white';            saveBtn.style.border = 'none';            saveBtn.onclick = async () => {                const newText = textarea.value.trim();                if (newText) {                    bubble.innerHTML = formatMessage(newText);                    messageElement.setAttribute('data-text', newText);                                        // Update conversation history                    const msgIndex = conversationHistory.findIndex(m => m.role === 'user' && m.content === originalText);                    if (msgIndex !== -1) {                        conversationHistory[msgIndex].content = newText;                                                // Remove all messages after this one (including AI responses)                        conversationHistory = conversationHistory.slice(0, msgIndex + 1);                                                // Remove subsequent DOM elements                        let nextSibling = messageElement.nextElementSibling;                        while (nextSibling) {                            const toRemove = nextSibling;                            nextSibling = nextSibling.nextElementSibling;                            toRemove.remove();                        }                                                saveCurrentChat();                                                // Resend the message to get new AI response                        await resendEditedMessage(newText);                    }                }            };            const cancelBtn = document.createElement('button');            cancelBtn.textContent = 'Cancel';            cancelBtn.className = 'action-btn';            cancelBtn.onclick = () => {                bubble.innerHTML = originalText;            };            buttonsDiv.appendChild(saveBtn);            buttonsDiv.appendChild(cancelBtn);            bubble.innerHTML = '';            bubble.appendChild(textarea);            bubble.appendChild(buttonsDiv);            textarea.focus();        }        // Regenerate response function        async function regenerateResponse(messageId) {            if (isResponseGenerating) {                alert('Please wait for the current response to complete.');                return;            }            const messageElement = document.getElementById(messageId);            if (!messageElement) return;            // Find this message in conversation history            const messages = document.querySelectorAll('.message');            let messageIndex = -1;                        for (let i = 0; i < messages.length; i++) {                if (messages[i].id === messageId) {                    messageIndex = i;                    break;                }            }            if (messageIndex === -1) return;            // Remove this and all subsequent messages            const allMessages = Array.from(messages);            for (let i = messageIndex; i < allMessages.length; i++) {                allMessages[i].remove();            }            // Truncate conversation history            const userMessagesCount = Math.ceil(messageIndex / 2);            conversationHistory = conversationHistory.slice(0, userMessagesCount * 2 - 1);            // Get last user message            const lastUserMessage = conversationHistory[conversationHistory.length - 1];            if (!lastUserMessage || lastUserMessage.role !== 'user') return;            // Regenerate response            isResponseGenerating = true;            updateSendButton();            const loadingId = addMessage('<div class="loading-dots"><span></span><span></span><span></span></div>', 'assistant');            let fullResponse = '';            abortController = new AbortController();            try {                const messagesWithContext = [                    {                        role: 'system',                        content: createSystemPrompt(lastUserMessage.content)                    },                    ...conversationHistory                ];                // Detect if this is an image generation request                const isImageRequest = detectImageRequest(message);                                // If it's an image generation request, use Pollinations AI                if (isImageRequest) {                    await generateImageWithPollinations(message, loadingId);                    return;                }                                const modelToUse = 'arcee-ai/trinity-large-preview:free';                                const response = await fetch(API_URL, {                    method: 'POST',                    headers: {                        'Content-Type': 'application/json',                        'Authorization': `Bearer ${API_KEY}`,                        'HTTP-Referer': window.location.href,                        'X-Title': 'MRE AI Chat'                    },                    body: JSON.stringify({                        model: modelToUse,                        messages: messagesWithContext,                        temperature: 0.7,                        max_tokens: 2048,                        stream: true                    }),                    signal: abortController.signal                });                if (!response.ok) {                    throw new Error(`API error: ${response.status}`);                }                const reader = response.body.getReader();                const decoder = new TextDecoder();                                updateMessage(loadingId, '<span class="typing-cursor"></span>');                while (true) {                    const { done, value } = await reader.read();                    if (done) break;                    const chunk = decoder.decode(value);                    const lines = chunk.split('\n');                    for (const line of lines) {                        if (line.startsWith('data: ')) {                            const data = line.slice(6);                            if (data === '[DONE]') continue;                                                        try {                                const parsed = JSON.parse(data);                                                                // Check multiple possible response formats                                let content = parsed.choices?.[0]?.delta?.content;                                                                // Alternative formats for different models                                if (!content) {                                    content = parsed.choices?.[0]?.message?.content;                                }                                if (!content && parsed.content) {                                    content = parsed.content;                                }                                if (!content && parsed.text) {                                    content = parsed.text;                                }                                                                if (content) {                                    fullResponse += content;                                    updateMessage(loadingId, formatMessage(fullResponse) + '<span class="typing-cursor"></span>');                                                                        const chatArea = document.getElementById('chatArea');                                    chatArea.scrollTop = chatArea.scrollHeight;                                }                            } catch (e) {                                console.error('Parse error:', e);                                // Skip invalid JSON                            }                        }                    }                }                updateMessage(loadingId, formatMessage(fullResponse));                conversationHistory.push({                    role: 'assistant',                    content: fullResponse                });                saveCurrentChat();            } catch (error) {                if (error.name === 'AbortError') {                    if (fullResponse && fullResponse.trim()) {                        updateMessage(loadingId, formatMessage(fullResponse) + '<p style="color: #999; font-size: 0.85em; font-style: italic; margin-top: 8px;">Response stopped</p>');                        conversationHistory.push({                            role: 'assistant',                            content: fullResponse                        });                        saveCurrentChat();                    } else {                        updateMessage(loadingId, '<p style="color: #999; font-style: italic;">Response stopped by user.</p>');                    }                } else {                    updateMessage(loadingId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ üôè<br>Sorry, an error occurred. Please try again.');                    console.error('Error:', error);                }            } finally {                isResponseGenerating = false;                abortController = null;                updateSendButton();            }        }        // Copy message function        function copyMessage(messageId) {            const messageElement = document.getElementById(messageId);            if (!messageElement) return;            const bubble = messageElement.querySelector('.message-bubble');            if (!bubble) return;            // Get text content without HTML            const text = bubble.innerText || bubble.textContent;            // Copy to clipboard            navigator.clipboard.writeText(text).then(() => {                // Show feedback                const copyBtn = messageElement.querySelector('.action-btn[onclick*="copyMessage"]');                if (copyBtn) {                    const originalHTML = copyBtn.innerHTML;                    copyBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">                        <polyline points="20 6 9 17 4 12"/>                    </svg> Copied!`;                    copyBtn.style.color = 'green';                                        setTimeout(() => {                        copyBtn.innerHTML = originalHTML;                        copyBtn.style.color = '';                    }, 2000);                }            }).catch(err => {                console.error('Failed to copy:', err);                alert('Failed to copy message');            });        }        function createSystemPrompt(userQuery) {            // Get user's name from currentUser            const userName = currentUser ? currentUser.name : '';                        // Check for Bengali Unicode characters            const hasBengaliScript = userQuery && /[\u0980-\u09FF]/.test(userQuery);                        // Check for Romanized Bengali (Banglish) patterns            const banglishPatterns = [                /\b(tumi|ami|apni|kemon|aso|achen|koro|korcho|hobe|hoye|jabo|gelo|gese|ache|nai|na|kintu|ar|ebong|tao|vai|bhai|apa|bondhu|khabar|khabo|kheyechi|jani|janina|bujhi|bujhina|dekho|dekhechi|valo|bhalo|kharap|sundor|shundor|kothai|kothay|keno|ki|kotha|kokhon|kobe|ektu|onek|thik|ase|ache)\b/i,                /\b(aso|asho|korchho|korcho|korchis|korso|koro|hoyeche|hoise|hoiche|geche|gese|jaccho|jachcho|jao|janina|jani|bujhina|bujhi)\b/i,                /\b(hae|hoise|hoiche|hoyeche|ache|nai|korchis|korchho|asche|ashche|ashbe|asbe|jabe|jabo|jacchi)\b/i            ];                        const isRomanizedBengali = banglishPatterns.some(pattern => pattern.test(userQuery));                        if (hasBengaliScript || isRomanizedBengali) {                return `You are MRE AI, a helpful and friendly AI assistant. You can communicate fluently in both Bengali and English. ${userName ? `IMPORTANT: The user's name is "${userName}". Remember this name. If the user asks "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø", "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ", "amar nam ki", "what is my name", or similar questions about their name, you MUST reply with their name "${userName}".` : ''}IMPORTANT: When the user writes in Romanized Bengali/Banglish (Bengali words written in English letters like "tumi kamon aso", "ki korcho", "valo achi"), you MUST respond in Bengali script (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶≤‡¶ø‡¶™‡¶ø), not in English or Romanized form.Examples:- User: "tumi kamon aso?" ‚Üí Reply in Bengali: "‡¶Ü‡¶Æ‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ü‡¶õ‡¶ø, ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßã?"- User: "ki korcho?" ‚Üí Reply in Bengali: "‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßÄ ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞?"- User: "valo achi" ‚Üí Reply in Bengali: "‡¶ñ‡ßÅ‡¶¨ ‡¶≠‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø ‡¶ï‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?"${userName ? `- User: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?" ‚Üí Reply in Bengali: "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ${userName}‡•§"- User: "amar nam ki?" ‚Üí Reply in Bengali: "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ${userName}‡•§"` : ''}When the user writes in Bengali script (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ), respond in Bengali script.When the user writes in proper English, respond in English.Be conversational, helpful, and respectful.`;            }                        return `You are MRE AI, a helpful and friendly AI assistant. Provide clear, concise, and accurate responses. Be conversational and professional.${userName ? ` The user's name is "${userName}". If they ask about their name, tell them it is "${userName}".` : ''}`;        }        // Toggle Settings Panel        function toggleSettings() {            const panel = document.getElementById('settingsPanel');            panel.classList.toggle('open');        }        // Profile Image Functions        function handleProfileImageUpload(event) {            const file = event.target.files[0];            if (!file) return;            if (!file.type.startsWith('image/')) {                alert('Please select an image file');                return;            }            if (file.size > 5 * 1024 * 1024) {                alert('Image size should be less than 5MB');                return;            }            const reader = new FileReader();            reader.onload = function(e) {                profileImage = e.target.result;                localStorage.setItem(`profileImage_${currentUser.email}`, profileImage);                updateProfileImages();                document.getElementById('removePhotoBtn').style.display = 'inline-block';            };            reader.readAsDataURL(file);        }        function updateProfileImages() {            const initial = currentUser.name.charAt(0).toUpperCase();                        // Update settings preview            const preview = document.getElementById('profilePreview');            const profileInitial = document.getElementById('profileInitial');                        if (profileImage) {                preview.innerHTML = `<img src="${profileImage}" alt="Profile">`;                document.getElementById('removePhotoBtn').style.display = 'inline-block';            } else {                preview.innerHTML = `<span id="profileInitial">${initial}</span>`;                document.getElementById('removePhotoBtn').style.display = 'none';            }            // Update sidebar avatar            const userAvatar = document.getElementById('userAvatar');            if (profileImage) {                userAvatar.innerHTML = `<img src="${profileImage}" alt="${currentUser.name}">`;            } else {                userAvatar.textContent = initial;            }        }        function removeProfilePhoto() {            if (confirm('Are you sure you want to remove your profile photo?')) {                profileImage = null;                localStorage.removeItem(`profileImage_${currentUser.email}`);                updateProfileImages();            }        }        // Initialize on load        window.addEventListener('load', () => {            setTimeout(() => {                const loadingScreen = document.getElementById('loadingScreen');                loadingScreen.classList.add('hide');                                // Remove from DOM after animation completes (1.2s animation + 0.3s buffer)                setTimeout(() => {                    loadingScreen.style.display = 'none';                }, 1500);                                // Play welcome audio                setTimeout(() => {                    playWelcomeAudio();                }, 800);                                checkAuth();                                // Initialize Google Sign-In                setTimeout(() => {                    initGoogleSignIn();                }, 500);            }, 2000);        });        // Welcome audio function        function playWelcomeAudio() {            // Check if browser supports speech synthesis            if ('speechSynthesis' in window) {                const utterance = new SpeechSynthesisUtterance('Welcome to my MRE AI');                utterance.lang = 'en-US';                utterance.rate = 0.9;                utterance.pitch = 1;                utterance.volume = 1;                                window.speechSynthesis.speak(utterance);            }        }        // Auto-hide upload menu when clicking outside        document.addEventListener('click', function(e) {            const uploadMenu = document.getElementById('uploadMenu');            const attachBtn = document.querySelector('.attach-btn');                        if (uploadMenu && !uploadMenu.contains(e.target) && !attachBtn.contains(e.target)) {                uploadMenu.classList.remove('show');            }        });    </script></body></html>